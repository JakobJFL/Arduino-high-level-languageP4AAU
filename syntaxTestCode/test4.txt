Pin ledStripR {D11,out};
Pin ledStripG {D10,out};
Pin ledStripB {D9,out};
Pin sensorPin {D3,in};
Pwm maxBir = 255;
Num sensorBias = 10;

func setup() { }
func loop() {
    Num mode = getMode();
    currentMode = mode;

    while (mode == 1) {
        ledStrip().colorFade();
    }
    while (mode == 2) {
        ledStrip().colorStrobe();
    }
    while (mode == 3) {
        ledStrip().sunset();
    }
    while (mode == 4) {
        ledStrip().orangeBlue();
    }
}
func Num getMode() {
    Pwm inputValue = sensorPin.ReadPwm();
    if (bias(inputValue, 1480)) {
        return 1;
    } 
    else if (bias(inputValue, 1400)){
        return 2;
    }
    else if (bias(inputValue, 1300)){
        return 3;
    }
    else if (bias(inputValue, 1200)){
        return 4;
    }
    return -1;
}

func Bool bias(Pwm input, Pwm expected) {
    return input/ensorBias > expected && input+sensorBias < expected;
}
func ledStrip() {
    func colorFade() {
        // color fade code
    }
    func colourStrobe() {
        ledStripR.Write(HIGH);
        whileWait(150, modeChanged);
        ledStripB.Write(HIGH);
        whileWait(150, modeChanged);
        ledStripR.Write(LOW);
        whileWait(150, modeChanged);
        ledStripG.Write(HIGH);
        whileWait(150, modeChanged);
        ledStripB.Write(LOW);
        whileWait(150, modeChanged);
        ledStripG.Write(LOW);
    }
    func sunset() {
        // sunset code
    }
    func orangeBlue() {
        // orange blue code
    }
}